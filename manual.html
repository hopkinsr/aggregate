<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8" /><title>aggregate</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default" /><link rel="stylesheet" type="text/css" href="racket.css" title="default" /><link rel="stylesheet" type="text/css" href="scribble-style.css" title="default" /><script type="text/javascript" src="scribble-common.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist" style="margin-bottom: 1em;"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="" class="tocviewselflink" data-pltdoc="x">aggregate</a></td></tr></table></div><div class="tocviewsublistonly" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="#%28part._.Appetiser%29" class="tocviewlink" data-pltdoc="x">Appetiser</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="#%28part._.S.Q.L-style_aggregates%29" class="tocviewlink" data-pltdoc="x">SQL-<wbr></wbr>style aggregates</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="#%28part._.The_aggregator_interface%29" class="tocviewlink" data-pltdoc="x">The aggregator interface</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="#%28part._.Provided_aggregates%29" class="tocviewlink" data-pltdoc="x">Provided aggregates</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="#%28part._.Simple_shop_example_and_description%29" class="tocviewlink" data-pltdoc="x">Simple shop example and description</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="#%28part._.Provided_aggregate_constructor_wrappers%29" class="tocviewlink" data-pltdoc="x">Provided aggregate constructor wrappers</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="#%28part._.Aggregate_building_operations%29" class="tocviewlink" data-pltdoc="x">Aggregate building operations</a></td></tr><tr><td align="right">8&nbsp;</td><td><a href="#%28part._math_statistics_wrappers%29" class="tocviewlink" data-pltdoc="x">math/<span class="mywbr"> &nbsp;</span>statistics wrappers</a></td></tr><tr><td align="right">9&nbsp;</td><td><a href="#%28part._.Examples%29" class="tocviewlink" data-pltdoc="x">Examples</a></td></tr><tr><td align="right">10&nbsp;</td><td><a href="#%28part._.Requirements%29" class="tocviewlink" data-pltdoc="x">Requirements</a></td></tr></table></div></div></div><div class="tocsub"><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">1<tt>&nbsp;</tt></span><a href="#(part._.Appetiser)" class="tocsubseclink" data-pltdoc="x">Appetiser</a></td></tr><tr><td><span class="tocsublinknumber">2<tt>&nbsp;</tt></span><a href="#(part._.S.Q.L-style_aggregates)" class="tocsubseclink" data-pltdoc="x">SQL-<wbr></wbr>style aggregates</a></td></tr><tr><td><span class="tocsublinknumber">3<tt>&nbsp;</tt></span><a href="#(part._.The_aggregator_interface)" class="tocsubseclink" data-pltdoc="x">The aggregator interface</a></td></tr><tr><td><span class="tocsublinknumber">4<tt>&nbsp;</tt></span><a href="#(part._.Provided_aggregates)" class="tocsubseclink" data-pltdoc="x">Provided aggregates</a></td></tr><tr><td><span class="tocsublinknumber">5<tt>&nbsp;</tt></span><a href="#(part._.Simple_shop_example_and_description)" class="tocsubseclink" data-pltdoc="x">Simple shop example and description</a></td></tr><tr><td><span class="tocsublinknumber">6<tt>&nbsp;</tt></span><a href="#(part._.Provided_aggregate_constructor_wrappers)" class="tocsubseclink" data-pltdoc="x">Provided aggregate constructor wrappers</a></td></tr><tr><td><span class="tocsublinknumber">7<tt>&nbsp;</tt></span><a href="#(part._.Aggregate_building_operations)" class="tocsubseclink" data-pltdoc="x">Aggregate building operations</a></td></tr><tr><td><span class="tocsublinknumber">8<tt>&nbsp;</tt></span><a href="#(part._math_statistics_wrappers)" class="tocsubseclink" data-pltdoc="x">math/<span class="mywbr"> &nbsp;</span>statistics wrappers</a></td></tr><tr><td><span class="tocsublinknumber">9<tt>&nbsp;</tt></span><a href="#(part._.Examples)" class="tocsubseclink" data-pltdoc="x">Examples</a></td></tr><tr><td><span class="tocsublinknumber">10<tt>&nbsp;</tt></span><a href="#(part._.Requirements)" class="tocsubseclink" data-pltdoc="x">Requirements</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="versionNoNav">5.3.6</span></div><h2><a name="(part._aggregate)"></a>aggregate</h2><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>IMPORTANT: Currently in development. There may be breakages before the
first release of this as a proper Racket 6 package.</p></blockquote></blockquote></blockquote><p>A Racket library to implement and use SQL-style aggregate functions over
a stream of values, as well as simple wrappers for the math/statistics
modules for use in exploratory analysis.</p><h3>1<tt>&nbsp;</tt><a name="(part._.Appetiser)"></a>Appetiser</h3><p>Lets get tasting. First, some standard definitions.</p><p><table cellspacing="0" class="RktBlk"><tr><td><p>Examples:</p></td></tr><tr><td><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">struct</span><span class="hspace">&nbsp;</span><span class="RktSym">product</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">section</span><span class="hspace">&nbsp;</span><span class="RktSym">name</span><span class="hspace">&nbsp;</span><span class="RktSym">quantity</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">shop</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">product</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">food</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">chocolate-bar</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">product</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">literature</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">magazine</span><span class="hspace">&nbsp;</span><span class="RktVal">4</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">product</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">food</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">bonbons</span><span class="hspace">&nbsp;</span><span class="RktVal">20</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote></td></tr></table></p><ul><li><p><div class="SIntrapara">Some common statistics for a range of numbers.
</div><div class="SIntrapara"><table cellspacing="0" class="RktBlk"><tr><td><p>Examples:</p></td></tr><tr><td><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">xs</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">range</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">aggregate</span><span class="hspace">&nbsp;</span><span class="RktSym">xs</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">(list <span class="stt"> </span>(aggregate/count <span class="stt"> </span>10<span class="stt"> </span>#&lt;procedure:const&gt;))</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">aggregate</span><span class="hspace">&nbsp;</span><span class="RktSym">xs</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">--&gt;</span>min</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">--&gt;</span>max</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">--&gt;</span>count</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">--&gt;</span>sum</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">(list <span class="stt"> </span>(aggregate/min <span class="stt"> </span>0<span class="stt"> </span>#&lt;procedure:identity&gt;<span class="stt"> </span>#&lt;procedure:&lt;&gt;<span class="stt"> </span>0)<span class="stt"> </span>(aggregate/max <span class="stt"> </span>9<span class="stt"> </span>#&lt;procedure:identity&gt;<span class="stt"> </span>#&lt;procedure:&gt;&gt;<span class="stt"> </span>9)<span class="stt"> </span>(aggregate/count <span class="stt"> </span>10<span class="stt"> </span>#&lt;procedure:const&gt;)<span class="stt"> </span>(aggregate/sum <span class="stt"> </span>45<span class="stt"> </span>#&lt;procedure:identity&gt;))</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">aggregate/summary</span><span class="hspace">&nbsp;</span><span class="RktSym">xs</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'((count<span class="stt"> </span>10)<span class="stt"> </span>(min<span class="stt"> </span>0)<span class="stt"> </span>(max<span class="stt"> </span>9)<span class="stt"> </span>(mean<span class="stt"> </span>9/2))</span></p></td></tr></table></blockquote></td></tr></table></div></p></li><li><p><div class="SIntrapara">Total count of products, and the minimum quantity.
</div><div class="SIntrapara"><table cellspacing="0" class="RktBlk"><tr><td><p>Example:</p></td></tr><tr><td><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><table cellspacing="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">aggregate/agg-val</span><span class="hspace">&nbsp;</span><span class="RktSym">shop</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">--&gt;</span>count</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">--&gt;</span>min</span><span class="hspace">&nbsp;</span><span class="RktPn">#:key</span><span class="hspace">&nbsp;</span><span class="RktSym">product-quantity</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktRes">'(3<span class="stt"> </span>4)</span></p></td></tr></table></blockquote></td></tr></table></div></p></li><li><p><div class="SIntrapara">First and last countries if we listed them lexicographically.
</div><div class="SIntrapara"><table cellspacing="0" class="RktBlk"><tr><td><p>Example:</p></td></tr><tr><td><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><table cellspacing="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">aggregate/agg-val</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list</span><span class="hspace">&nbsp;</span><span class="RktVal">"Germany"</span><span class="hspace">&nbsp;</span><span class="RktVal">"Argentina"</span><span class="hspace">&nbsp;</span><span class="RktVal">"Japan"</span><span class="hspace">&nbsp;</span><span class="RktVal">"Zimbabwe"</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">--&gt;</span>min</span><span class="hspace">&nbsp;</span><span class="RktPn">#:&lt;operator</span><span class="hspace">&nbsp;</span><span class="RktSym">string&lt;?</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">--&gt;</span>max</span><span class="hspace">&nbsp;</span><span class="RktPn">#:&gt;operator</span><span class="hspace">&nbsp;</span><span class="RktSym">string&gt;?</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktRes">'("Argentina"<span class="stt"> </span>"Zimbabwe")</span></p></td></tr></table></blockquote></td></tr></table></div></p></li><li><p><div class="SIntrapara">Simple binning of numbers.
</div><div class="SIntrapara"><table cellspacing="0" class="RktBlk"><tr><td><p>Example:</p></td></tr><tr><td><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">group</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">5</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="hspace">&nbsp;</span><span class="RktVal">6</span><span class="hspace">&nbsp;</span><span class="RktVal">7</span><span class="hspace">&nbsp;</span><span class="RktVal">7</span><span class="hspace">&nbsp;</span><span class="RktVal">8</span><span class="hspace">&nbsp;</span><span class="RktVal">8</span><span class="hspace">&nbsp;</span><span class="RktVal">8</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">(hash<span class="stt"> </span>5<span class="stt"> </span>(list <span class="stt"> </span>(aggregate/count <span class="stt"> </span>4<span class="stt"> </span>#&lt;procedure:const&gt;))<span class="stt"> </span>6<span class="stt"> </span>(list <span class="stt"> </span>(aggregate/count <span class="stt"> </span>1<span class="stt"> </span>#&lt;procedure:const&gt;))<span class="stt"> </span>7<span class="stt"> </span>(list <span class="stt"> </span>(aggregate/count <span class="stt"> </span>2<span class="stt"> </span>#&lt;procedure:const&gt;))<span class="stt"> </span>8<span class="stt"> </span>(list <span class="stt"> </span>(aggregate/count <span class="stt"> </span>3<span class="stt"> </span>#&lt;procedure:const&gt;)))</span></p></td></tr></table></blockquote></td></tr></table></div></p></li><li><p>Slightly more advanced binning of numbers: we want to know how many
are odd and even in a given range, along with the respective sums.</p><table cellspacing="0" class="RktBlk"><tr><td><p>Example:</p></td></tr><tr><td><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><table cellspacing="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">group</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">range</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:key</span><span class="hspace">&nbsp;</span><span class="RktSym">even?</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:aggregates</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">thunk</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">--&gt;</span>count</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">--&gt;</span>sum</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktRes">(hash<span class="stt"> </span>#t<span class="stt"> </span>(list <span class="stt"> </span>(aggregate/count <span class="stt"> </span>5<span class="stt"> </span>#&lt;procedure:const&gt;)<span class="stt"> </span>(aggregate/sum <span class="stt"> </span>20<span class="stt"> </span>#&lt;procedure:identity&gt;))<span class="stt"> </span>#f<span class="stt"> </span>(list <span class="stt"> </span>(aggregate/count <span class="stt"> </span>5<span class="stt"> </span>#&lt;procedure:const&gt;)<span class="stt"> </span>(aggregate/sum <span class="stt"> </span>25<span class="stt"> </span>#&lt;procedure:identity&gt;)))</span></p></td></tr></table></blockquote></td></tr></table></li><li><p>They don&rsquo;t have to be numbers. We want to know how many different products
do we have in each section, along with how much stock.</p><table cellspacing="0" class="RktBlk"><tr><td><p>Example:</p></td></tr><tr><td><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><table cellspacing="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">group</span><span class="hspace">&nbsp;</span><span class="RktSym">shop</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:key</span><span class="hspace">&nbsp;</span><span class="RktSym">product-section</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:aggregates</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">thunk</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">--&gt;</span>count</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">--&gt;</span>sum</span><span class="hspace">&nbsp;</span><span class="RktPn">#:key</span><span class="hspace">&nbsp;</span><span class="RktSym">product-quantity</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktRes">(hash<span class="stt"> </span>'food<span class="stt"> </span>(list <span class="stt"> </span>(aggregate/count <span class="stt"> </span>2<span class="stt"> </span>#&lt;procedure:const&gt;)<span class="stt"> </span>(aggregate/sum <span class="stt"> </span>25<span class="stt"> </span>#&lt;procedure:product-quantity&gt;))<span class="stt"> </span>'literature<span class="stt"> </span>(list <span class="stt"> </span>(aggregate/count <span class="stt"> </span>1<span class="stt"> </span>#&lt;procedure:const&gt;)<span class="stt"> </span>(aggregate/sum <span class="stt"> </span>4<span class="stt"> </span>#&lt;procedure:product-quantity&gt;)))</span></p></td></tr></table></blockquote></td></tr></table></li></ul><h3>2<tt>&nbsp;</tt><a name="(part._.S.Q.L-style_aggregates)"></a>SQL-style aggregates</h3><p>For example, the following SQL query</p><p><table cellspacing="0"><tr><td><p><span class="stt"><span class="stt">SELECT COUNT(*), MIN(n), MAX(n), AVG(n)</span></span></p></td></tr><tr><td><p><span class="stt"><span class="stt">FROM PositiveIntegers</span></span></p></td></tr><tr><td><p><span class="stt"><span class="stt">WHERE n BETWEEN 0 AND 9</span></span></p></td></tr></table></p><p>will produce a single row:</p><p><table cellspacing="0"><tr><td><p><span class="stt">COUNT(*)<span class="hspace">&nbsp;&nbsp;</span>MIN(n)<span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span>MAX(n)<span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">AVG(n)</span></span></p></td></tr><tr><td><p><span class="stt">10<span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>0<span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>9<span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">4.5</span></span></p></td></tr></table></p><p>This library provides basic aggregate functions to mirror the SQL equivalents
such as MIN, MAX, COUNT, etc, as well as provide a framework for applications
to implement their own aggregate functions and be treated as first-class
citizens along with the ones provided.</p><p>Specifically, it uses Racket&rsquo;s generics facility so all aggregators, provided
or custom, must implement the aggregator interface.</p><h3>3<tt>&nbsp;</tt><a name="(part._.The_aggregator_interface)"></a>The aggregator interface</h3><p>Each aggregator must implement the aggregator interface. In Racket this is
defined as</p><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">define-generics</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">aggregator</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">agg-val</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">aggregator</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">agg-step</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">aggregator</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">agg-finish</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">aggregator</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><ul><li><p>agg-val</p><p>An aggregator must produce a value after visiting the whole stream.
In the SQL example above, the MAX aggregator produced the value 9
for all the positive integers between 0 and 9.</p><p>This method must return the correct value after receiving all
necessary values via agg-step and having agg-finish applied
on completion.</p><p>It can return a "current state" if applied part-way through a stream,
for example, or after visiting the whole stream without applying
agg-finish. In this case the answer may or may not be correct, may be
approximate or even be completely wrong.</p></li><li><p>agg-step</p><p>Each aggregate must have a way of obtaining new information so it
can transition from one state to the next. It does not have to
change state after each call to agg-step.</p><p>e.g. In the SQL example	above, the state of the MIN aggregate does
not change after 0 even though it received all of the values.</p></li><li><p>agg-finish</p><p>After receiving all of the values from the stream through agg-step,
the aggregate may need to perform a final calculation to produce
the correct value from agg-val.</p><p>For simple aggregates such as MIN, MAX, COUNT etc, this is not needed
and they do nothing. More complex aggregates, however, might need to
perform extra calculations and they must do it here.</p><p>The return value is that of agg-val.</p></li></ul><h3>4<tt>&nbsp;</tt><a name="(part._.Provided_aggregates)"></a>Provided aggregates</h3><p>The provided aggregates, although implemented as structs are, not constructed
through the standard constructor: they have a corresponding wrapper to ease
use. Just remember, if you are playing in the REPL the aggregates will print
with the struct name.</p><p>You will typically interface with the aggregates through</p><ul><li><p>these constructor wrappers;</p></li><li><p>the standard aggregator interface (e.g. <span class="RktSym">agg-val</span><span class="RktMeta"></span>); or</p></li><li><p>the provided aggregate builders which process a stream of values to obtain
final aggregate results (e.g. <span class="RktSym">aggregate</span><span class="RktMeta"></span>.</p></li></ul><p>The naming convention for aggregates are to name the</p><ul><li><p>aggregate struct in the form <span class="RktSym">aggregate/operation</span><span class="RktMeta"></span>; and the</p></li><li><p>constructor wrapper in the form <span class="RktSym"><span class="nobreak">--&gt;</span>operation</span><span class="RktMeta"></span>.</p></li></ul><p>Each provided aggregate constructor wrapper (and aggregate struct) also takes
a "key" which is applied to the input of <span class="RktSym">agg-step</span><span class="RktMeta"></span>. The result of applying this
key, and not the input value, is used for the transition (if any).</p><p>This simulates passing an expression to an aggregate function in SQL.</p><p>i.e. in SQL instead of MIN(&lt;the-whole-row&gt;) it is MIN(column_name) for example.</p><p>Likewise, instead of <span class="RktPn">(</span><span class="RktSym">agg-step</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">any-racket-value</span><span class="RktPn">)</span><span class="RktMeta"></span>, conceptually* it will be
<span class="RktPn">(</span><span class="RktSym">agg-step</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">key</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">any-racket-value</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span>. As you might not need a key, such as
aggregating a simple list of numbers, the default key is <span class="RktSym">identity</span><span class="RktMeta"></span>.</p><p>* not really, see <span class="RktSym"><span class="nobreak">--&gt;</span>min</span><span class="RktMeta"></span> and <span class="RktSym"><span class="nobreak">--&gt;</span>max</span><span class="RktMeta"></span>.</p><p>The key is specified using the keyword argument <span class="RktPn">#:key</span><span class="RktMeta"></span>.</p><h3>5<tt>&nbsp;</tt><a name="(part._.Simple_shop_example_and_description)"></a>Simple shop example and description</h3><p>For example, you might own a "poundshop" where every item is &#163;1, and have
written a simple application to keep track of stock. See the appetisers
for the definition of this shop.</p><p><table cellspacing="0" class="RktBlk"><tr><td><p>Example:</p></td></tr><tr><td><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktSym">shop</span></td></tr><tr><td><p><span class="RktRes">(list <span class="stt"> </span>(product <span class="stt"> </span>'food<span class="stt"> </span>'chocolate-bar<span class="stt"> </span>5)<span class="stt"> </span>(product <span class="stt"> </span>'literature<span class="stt"> </span>'magazine<span class="stt"> </span>4)<span class="stt"> </span>(product <span class="stt"> </span>'food<span class="stt"> </span>'bonbons<span class="stt"> </span>20))</span></p></td></tr></table></blockquote></td></tr></table></p><p>Now you want to have a quick overview of your shop, so we will aggregate it</p><p><table cellspacing="0" class="RktBlk"><tr><td><p>Examples:</p></td></tr><tr><td><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><table cellspacing="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">shop-summary</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">aggregate</span><span class="hspace">&nbsp;</span><span class="RktSym">shop</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">--&gt;</span>count</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">--&gt;</span>min</span><span class="hspace">&nbsp;</span><span class="RktPn">#:key</span><span class="hspace">&nbsp;</span><span class="RktSym">product-quantity</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktSym">shop-summary</span></td></tr><tr><td><p><span class="RktRes">(list <span class="stt"> </span>(aggregate/count <span class="stt"> </span>3<span class="stt"> </span>#&lt;procedure:const&gt;)<span class="stt"> </span>(aggregate/min <span class="stt"> </span>4<span class="stt"> </span>#&lt;procedure:product-quantity&gt;<span class="stt"> </span>#&lt;procedure:&lt;&gt;<span class="stt"> </span>(product <span class="stt"> </span>'literature<span class="stt"> </span>'magazine<span class="stt"> </span>4)))</span></p></td></tr></table></blockquote></td></tr></table></p><p>Ignore the funny looking things like #&lt;procedure&gt; for now, we&rsquo;ll come back to
it later. In short, they allow you to customise the behaviour of the aggregates.</p><p>The produced result says our shop has 3 products, and that the smallest
quantity of a product we have in stock is 4.</p><p>This is good, if our summary produced a quantity of 0 we might want to run
another report to find all products needing stock. However, as an extension to
the SQL-style MIN and MAX, whenever the state changes (which is based from the
key) we also save the given value. Note though that this ignores ties, and only
the "first" value of a tie is kept.</p><p>This means we no longer need to run another report and can get the information
from the summary</p><p><table cellspacing="0" class="RktBlk"><tr><td><p>Examples:</p></td></tr><tr><td><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">aggregate/min-item</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">second</span><span class="hspace">&nbsp;</span><span class="RktSym">shop-summary</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">(product <span class="stt"> </span>'literature<span class="stt"> </span>'magazine<span class="stt"> </span>4)</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">product-name</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">aggregate/min-item</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">second</span><span class="hspace">&nbsp;</span><span class="RktSym">shop-summary</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'magazine</span></p></td></tr></table></blockquote></td></tr></table></p><h3>6<tt>&nbsp;</tt><a name="(part._.Provided_aggregate_constructor_wrappers)"></a>Provided aggregate constructor wrappers</h3><p>Each constructor wrapper is of the form</p><p><table cellspacing="0"><tr><td><p><span class="stt"><span class="stt">(--&gt;operation initial-value #:key key)</span></span></p></td></tr></table></p><p>where <span class="RktSym">initial-value</span><span class="RktMeta"></span> and <span class="RktSym">key</span><span class="RktMeta"></span> are optional and defaults to <span class="RktPn">(</span><span class="RktSym">void</span><span class="RktPn">)</span><span class="RktMeta"></span>
and <span class="RktSym">identity</span><span class="RktMeta"></span> respectively.</p><p>The aggregators know that <span class="RktPn">(</span><span class="RktSym">void</span><span class="RktPn">)</span><span class="RktMeta"></span> can be the initial value and act accordingly.</p><p>e.g. <span class="RktSym"><span class="nobreak">--&gt;</span>sum</span><span class="RktMeta"></span> does not perform <span class="RktPn">(</span><span class="RktSym">+</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">current</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktMeta"></span> for the 1st state change as
<span class="RktSym">current</span><span class="RktMeta"></span> will be <span class="RktPn">(</span><span class="RktSym">void</span><span class="RktPn">)</span><span class="RktMeta"></span>.</p><p>Other constructor wrappers might have extra functionality and they are specified
as keyword arguments.</p><p>* <span class="RktSym"><span class="nobreak">--&gt;</span>count</span><span class="RktMeta"></span> (aggregate/count)</p><p>Simulates the SQL COUNT aggregate.</p><p>* <span class="RktSym"><span class="nobreak">--&gt;</span>sum</span><span class="RktMeta"></span> (aggregate/sum)</p><p>Simulates the SQL SUM aggregate.</p><p>* <span class="RktSym"><span class="nobreak">--&gt;</span>min</span><span class="RktMeta"></span> (aggregate/min)</p><p>Simulates the SQL MIN aggregate, but also saves the value when the
state changes.</p><p>The less than operator is customisable and is specified using
<span class="RktPn">#:&lt;operator</span><span class="RktMeta"></span>. The default is <span class="RktSym">&lt;</span><span class="RktMeta"></span>.</p><p>The input to the operator is the current state and the result of
applying the key to the given value from <span class="RktSym">agg-step</span><span class="RktMeta"></span>.</p><p>e.g. find the minimum string lexicographically according to <span class="RktSym">string&lt;?</span><span class="RktMeta"></span></p><p><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">--&gt;</span>min</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">#:&lt;operator</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">string&lt;?</span><span class="RktPn">)</span><span class="RktMeta"></span></p><p>* <span class="RktSym"><span class="nobreak">--&gt;</span>max</span><span class="RktMeta"></span> (aggregate/max)</p><p>Simulates the SQL MAX aggregate, but also saves the value when the
state changes.</p><p>The greater than operator is customisable and is specified using
<span class="RktPn">#:&gt;operator</span><span class="RktMeta"></span>. The default is <span class="RktSym">&gt;</span><span class="RktMeta"></span>.</p><p>The input to the operator is the current state and the result of
applying the key to the given value from <span class="RktSym">agg-step</span><span class="RktMeta"></span>.</p><p>e.g. find the minimum string lexicographically according to <span class="RktSym">string&gt;?</span><span class="RktMeta"></span></p><p><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">--&gt;</span>max</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">#:operator</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">string&gt;?</span><span class="RktPn">)</span><span class="RktMeta"></span></p><p>* <span class="RktSym"><span class="nobreak">--&gt;</span>mean</span><span class="RktMeta"></span> (aggregate/mean)</p><p>Simulates the SQL AVG aggregate and calculates the arithmetic mean.</p><p>This uses Rackets full numeric tower so the result will stay as
exact/inexact as the input.</p><p>If you would like a quicker way of calculating the mean consider using
the math/statistics library or the helpers provided here based on the
statistics calculators as they use flonums instead.</p><h3>7<tt>&nbsp;</tt><a name="(part._.Aggregate_building_operations)"></a>Aggregate building operations</h3><p>The aggregate building operations can take any stream of values, and not just
a list. Basically, if it can be iterated with <span class="RktSym">for</span><span class="RktMeta"></span>, you can aggregate it.</p><p>* <span class="RktPn">(</span><span class="RktSym">aggregate</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">aggregates</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">xs</span><span class="RktPn">)</span><span class="RktMeta"></span> -&gt; (listof aggregator?)</p><p>Visits each value from xs and passes it through each of the given
aggregates. On completion, each aggregate is then finalized with
<span class="RktSym">agg-finish</span><span class="RktMeta"></span>.</p><p>A new list containing the given aggregates with up-to-date values
is returned.</p><p><table cellspacing="0" class="RktBlk"><tr><td><p>Examples:</p></td></tr><tr><td><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><table cellspacing="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">agg-summary</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">aggregate</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">range</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">--&gt;</span>count</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">--&gt;</span>sum</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktSym">agg-summary</span></td></tr><tr><td><p><span class="RktRes">(list <span class="stt"> </span>(aggregate/count <span class="stt"> </span>10<span class="stt"> </span>#&lt;procedure:const&gt;)<span class="stt"> </span>(aggregate/sum <span class="stt"> </span>45<span class="stt"> </span>#&lt;procedure:identity&gt;))</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">map</span><span class="hspace">&nbsp;</span><span class="RktSym">agg-val</span><span class="hspace">&nbsp;</span><span class="RktSym">agg-summary</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(10<span class="stt"> </span>45)</span></p></td></tr></table></blockquote></td></tr></table></p><p>* <span class="RktPn">(</span><span class="RktSym">aggregate/summary</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">xs</span><span class="RktPn">)</span><span class="RktMeta"></span> -&gt; (listof (listof symbol? number?) ...)</p><p>Calls aggregate with some common aggregates, then returns a simple summary.</p><p><div class="SIntrapara">e.g. aggregate a list. note the exact 4.5.
</div><div class="SIntrapara"><table cellspacing="0" class="RktBlk"><tr><td><p>Example:</p></td></tr><tr><td><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">aggregate/summary</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">range</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'((count<span class="stt"> </span>10)<span class="stt"> </span>(min<span class="stt"> </span>0)<span class="stt"> </span>(max<span class="stt"> </span>9)<span class="stt"> </span>(mean<span class="stt"> </span>9/2))</span></p></td></tr></table></blockquote></td></tr></table></div></p><p><div class="SIntrapara">e.g. aggregate a vector
</div><div class="SIntrapara"><table cellspacing="0" class="RktBlk"><tr><td><p>Example:</p></td></tr><tr><td><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">aggregate/summary</span><span class="hspace">&nbsp;</span><span class="RktVal">#</span><span class="RktVal">(</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="hspace">&nbsp;</span><span class="RktVal">4</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="hspace">&nbsp;</span><span class="RktVal">6</span><span class="hspace">&nbsp;</span><span class="RktVal">7</span><span class="hspace">&nbsp;</span><span class="RktVal">8</span><span class="hspace">&nbsp;</span><span class="RktVal">9</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'((count<span class="stt"> </span>10)<span class="stt"> </span>(min<span class="stt"> </span>0)<span class="stt"> </span>(max<span class="stt"> </span>9)<span class="stt"> </span>(mean<span class="stt"> </span>9/2))</span></p></td></tr></table></blockquote></td></tr></table></div></p><p>The format of the returned list is the same as the statistics summary
functions - but the values here adhere to <span class="RktSym">number?</span><span class="RktMeta"></span> and not <span class="RktSym">flonum?</span><span class="RktMeta"></span>
which is used by statistics.</p><p>* <span class="RktPn">(</span><span class="RktSym">group</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">xs</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">#:key</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">procedure?</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">#:aggregates</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">procedure?</span><span class="RktPn">)</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">hash</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">v</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">aggregates</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span></p><p>Where as <span class="RktSym">aggregate</span><span class="RktMeta"></span> is used to simulate the SQL aggregate functionality
by pumping in values with <span class="RktSym">agg-step</span><span class="RktMeta"></span> for a whole sequence, <span class="RktSym">group</span><span class="RktMeta"></span>
simulates the SQL GROUP BY functionality.</p><p><span class="RktSym">group</span><span class="RktMeta"></span> takes a sequence and performs a grouping. Each produced group
will be an entry (key) in the returned <span class="RktSym">hash</span><span class="RktMeta"></span> instance. The corresponding
value will be the specified aggregates which will be up-to-date.</p><p>In very-pseudo-SQL, it would look something like</p><p><table cellspacing="0"><tr><td><p><span class="stt"><span class="stt">SELECT key(row), agg1(row), agg2(row), ... aggn(row)</span></span></p></td></tr><tr><td><p><span class="stt"><span class="stt">FROM xs</span></span></p></td></tr><tr><td><p><span class="stt"><span class="stt">GROUP BY key(row)</span></span></p></td></tr></table></p><p><table cellspacing="0" class="RktBlk"><tr><td><p>Example:</p></td></tr><tr><td><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><table cellspacing="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">group</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">range</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:key</span><span class="hspace">&nbsp;</span><span class="RktSym">even?</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:aggregates</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">thunk</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">--&gt;</span>count</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">--&gt;</span>sum</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktRes">(hash<span class="stt"> </span>#t<span class="stt"> </span>(list <span class="stt"> </span>(aggregate/count <span class="stt"> </span>5<span class="stt"> </span>#&lt;procedure:const&gt;)<span class="stt"> </span>(aggregate/sum <span class="stt"> </span>20<span class="stt"> </span>#&lt;procedure:identity&gt;))<span class="stt"> </span>#f<span class="stt"> </span>(list <span class="stt"> </span>(aggregate/count <span class="stt"> </span>5<span class="stt"> </span>#&lt;procedure:const&gt;)<span class="stt"> </span>(aggregate/sum <span class="stt"> </span>25<span class="stt"> </span>#&lt;procedure:identity&gt;)))</span></p></td></tr></table></blockquote></td></tr></table></p><h3>8<tt>&nbsp;</tt><a name="(part._math_statistics_wrappers)"></a>math/statistics wrappers</h3><p>Many of these wrappers are intended mainly for use at a REPL or for quick
exploratory analysis and require the math/statistics library.</p><p>The summary functions are intended to have the same format as
<span class="RktSym">aggregate/summary</span><span class="RktMeta"></span>.</p><p>* (statistics-summary statistics) -&gt; (listof (listof symbol? flonum?) ...)</p><p>Returns basic statistical information from the given statistics.</p><p><table cellspacing="0" class="RktBlk"><tr><td><p>Example:</p></td></tr><tr><td><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">statistics-summary</span><span class="hspace">&nbsp;</span><span class="RktSym">empty-statistics</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'((count<span class="stt"> </span>0.0)<span class="stt"> </span>(min<span class="stt"> </span>+inf.0)<span class="stt"> </span>(max<span class="stt"> </span><span class="nobreak">-i</span>nf.0)<span class="stt"> </span>(mean<span class="stt"> </span>+nan.0))</span></p></td></tr></table></blockquote></td></tr></table></p><p>* <span class="RktPn">(</span><span class="RktSym">statistics-extended-summary</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">statistics</span><span class="RktPn">)</span><span class="RktMeta"></span> -&gt; (listof (listof symbol? flonum?) ...)</p><p>The same as statistics-summary but contains more statistical
information.</p><p><table cellspacing="0" class="RktBlk"><tr><td><p>Example:</p></td></tr><tr><td><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">statistics-extended-summary</span><span class="hspace">&nbsp;</span><span class="RktSym">empty-statistics</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'((count<span class="stt"> </span>0.0)<span class="stt"> </span>(min<span class="stt"> </span>+inf.0)<span class="stt"> </span>(max<span class="stt"> </span><span class="nobreak">-i</span>nf.0)<span class="stt"> </span>(mean<span class="stt"> </span>+nan.0)<span class="stt"> </span>(range<span class="stt"> </span>+nan.0)<span class="stt"> </span>(stddev<span class="stt"> </span>+nan.0)<span class="stt"> </span>(variance<span class="stt"> </span>+nan.0)<span class="stt"> </span>(skewness<span class="stt"> </span>+nan.0)<span class="stt"> </span>(kurtosis<span class="stt"> </span>+nan.0))</span></p></td></tr></table></blockquote></td></tr></table></p><p>* <span class="RktPn">(</span><span class="RktSym">collect-statistics</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">xs</span><span class="RktPn">)</span><span class="RktMeta"></span> -&gt; statistics</p><p>Returns up-to-date statistics after visiting each value from xs. The
returned instance can be then passed to the math/statistics procedures
such as <span class="RktSym">statistics-mean</span><span class="RktMeta"></span>, or to <span class="RktSym">statistics-summary</span><span class="RktMeta"></span> etc.</p><p>* <span class="RktPn">(</span><span class="RktSym">collect-statistics/summary</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">xs</span><span class="RktPn">)</span><span class="RktMeta"></span> -&gt; (listof (listof symbol? flonum?) ...)</p><p>Collects up-to-date statistics for xs then returns a list containing
a basic summary of the values.</p><p>Also see <span class="RktSym">statistics-summary</span><span class="RktMeta"></span>.</p><p>Note the inexact 4.5.</p><p><table cellspacing="0" class="RktBlk"><tr><td><p>Example:</p></td></tr><tr><td><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">collect-statistics/summary</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">range</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'((count<span class="stt"> </span>10.0)<span class="stt"> </span>(min<span class="stt"> </span>0.0)<span class="stt"> </span>(max<span class="stt"> </span>9.0)<span class="stt"> </span>(mean<span class="stt"> </span>4.5))</span></p></td></tr></table></blockquote></td></tr></table></p><p>* <span class="RktPn">(</span><span class="RktSym">collect-statistics/extended-summary</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">xs</span><span class="RktPn">)</span><span class="RktMeta"></span> -&gt; (listof (listof symbol? flonum?) ...)</p><p>* Performs the same duty as <span class="RktSym">collect-statistics/summary</span><span class="RktMeta"></span> but contains
more statistical information in the summary.</p><p>Also see <span class="RktSym">statistics-extended-summary</span><span class="RktMeta"></span>.</p><h3>9<tt>&nbsp;</tt><a name="(part._.Examples)"></a>Examples</h3><p>A simple summary example using the numbers 0-9 (inclusive).</p><p>Here, we want the count, minimum, maximum, maximum of the provided numbers
and 15, sum and the mean.</p><p><table cellspacing="0" class="RktBlk"><tr><td><p>Examples:</p></td></tr><tr><td><blockquote class="SCodeFlow"><table cellspacing="0" class="RktBlk"><tr><td><table cellspacing="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">summary</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">aggregate</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">range</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">--&gt;</span>count</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">--&gt;</span>min</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">--&gt;</span>max</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">--&gt;</span>max</span><span class="hspace">&nbsp;</span><span class="RktVal">15</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">--&gt;</span>sum</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">--&gt;</span>mean</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">map</span><span class="hspace">&nbsp;</span><span class="RktSym">agg-val</span><span class="hspace">&nbsp;</span><span class="RktSym">summary</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(10<span class="stt"> </span>0<span class="stt"> </span>9<span class="stt"> </span>15<span class="stt"> </span>45<span class="stt"> </span>9/2)</span></p></td></tr></table></blockquote></td></tr></table></p><h3>10<tt>&nbsp;</tt><a name="(part._.Requirements)"></a>Requirements</h3><p>Currently playing around with this in Racket 5.3.6, however, this is intended
to be released as a proper Racket 6 package later on.</p></div></div><div id="contextindicator">&nbsp;</div></body></html>